{% assign current_variant = product.selected_or_first_available_variant %}
{% assign featured_image = current_variant.featured_image | default: product.featured_image %}

<div class="px-2 pt-2 pb-24 md:pt-24 grid md:grid-cols-2 gap-8">
    <renderless-product-gallery v-slot="{ initialRender, currentImage, switchImage }">
        <div>
            <div>
                <img v-if="initialRender" src="{{ featured_image | img_url: '750x' }}" alt="{{ featured_image.alt | escape }}" loading="lazy" class="w-full h-auto object-cover object-center">

                <div v-else>
                    <img :alt="currentImage.alt" :key="currentImage.url" :src="currentImage.url" class="w-full h-full object-cover object-center" loading="lazy">
                </div>
            </div>

            {% if product.has_only_default_variant %}
                <div class="flex gap-4 mt-4">
                    {% for image in product.images %}
                        <link rel="preload" as="image" href="{{ image.src | img_url: '750x' }}">

                        <button class="w-20 md:w-24 h-20 md:h-24" data-url="{{ image.src | img_url: '750x' }}" data-alt="{{ image.alt | escape }}" @click="switchImage">
                            <img sizes="(min-width: 768px) 96px, 80px" srcset="{{ image.src | img_url: '80x' }} 80w, {{ image.src | img_url: '96x' }} 96w" src="{{ image.src | img_url: '96x' }}" alt="{{ image.alt | escape }}" loading="lazy" class="w-full h-full object-cover object-center pointer-events-none">
                        </button>
                    {% endfor %}
                </div>
            {% endif %}
        </div>
    </renderless-product-gallery>

    <div class="md:mt-12">
        {% if product.title %}
            <h1 class="text-2xl lg:text-3xl font-bold mb-4 md:mb-8">
                {{ product.title }}
            </h1>
        {% endif %}

        {% if current_variant.available %}
            <div class="mb-10">
                <div class="flex gap-3">
                    <span class="inline-block text-lg {% if current_variant.compare_at_price %}text-red-500{% endif %}">
                        {{ current_variant.price | money }}
                    </span>

                    {% if current_variant.compare_at_price %}
                        <del class="text-lg">
                            {{ current_variant.compare_at_price | money }}
                        </del>

                        <div class="bg-red-500 text-white text-sm tracking-wider uppercase px-2 py-1">
                            {{ 'common.sale' | t }}
                        </div>
                    {% endif %}
                </div>

                <div class="uppercase text-sm">
                    {% if shop.taxes_included %}
                        {{ 'common.including_tax' | t }}
                    {% else %}
                        {{ 'common.excluding_tax' | t }}
                    {% endif %}
                </div>
            </div>
        {% else %}
            <div class="mb-6 uppercase">
                {{ 'common.sold_out' | t }}
            </div>
        {% endif %}

        {% form 'product', product %}
            <div class="flex items-end gap-4 mb-6">

                {% if product.has_only_default_variant %}
                    <input name="id" type="hidden" :value="{{ current_variant.id }}" readonly>
                {% else %}
                    <div class="flex-1">
                        <renderless-product-variant-selector v-slot="{ selectedVariant, selectOption, goToVariant }" :current-variant="{{ current_variant | json | replace: '"', "'" }}" :product-options="{{ product.options_with_values | json | replace: '"', "'" }}" :product-variants="{{ product.variants | json | replace: '"', "'" }}">
                            <div>
                                <input :value="selectedVariant.id" name="id" readonly type="hidden">

                                <div>
                                    <h3 class="uppercase">Size</h3>

                                    <fieldset class="mt-4">
                                        <legend class="sr-only">Choose a size</legend>
                                        <div class="grid grid-flow-col gap-3 ">
                                            {% for variant in product.variants %}
                                                <label class="group relative border py-2 px-1 flex items-center justify-center text-sm font-medium uppercase hover:bg-black hover:text-white focus:outline-none sm:flex-1 {%if variant == current_variant %} bg-black text-white{% else %}bg-white  {% endif %}{% if variant.available %} cursor-pointer border-black{% else %} text-gray-200 cursor-not-allowed{% endif %}">
                                                    <input type="radio" @change="goToVariant({{ variant.id }})" name="size-choice" value="{{ variant.option1 }}" {% if variant.available == false %} disabled {% endif %} class="sr-only" aria-labelledby="size-choice-0-label">
                                                    <p id="size-choice-0-label">{{ variant.option1 }}</p>
                                                </label>
                                            {% endfor %}

                                        </div>
                                    </fieldset>
                                </div>

                                <div class="flex gap-x-3">
                                    {% for option in product.options_with_values %}
                                        {% if option.name != 'Size' %}

                                            <div class="flex-1">
                                                <label for="product-select-option-{{ forloop.index }}">
                                                    {{ option.name | escape }}
                                                </label>

                                                <select @change="selectOption({name: '{{ option.name }}'}, $event)" class="w-full h-12 border p-2" id="product-select-{{ forloop.index }}">
                                                    {% for value in option.values %}
                                                        <option value="{{ value }}" {% if option.selected_value == value %} selected {% endif %}>
                                                            {{ value | escape }}
                                                        </option>
                                                    {% endfor %}
                                                </select>
                                            </div>
                                        {% endif %}
                                    {% endfor %}
                                </div>
                            </div>
                        </renderless-product-variant-selector>
                    </div>
                {% endif %}
            </div>

            {% if current_variant.available %}
                <div class="grid grid-cols-2 gap-4">
                    <!-- <div class="">
				{{ form | payment_button }}
			</div> -->

                    <div>
                        <button class="button button-secondary w-full h-12" name="add">
                            {{ 'action.add_to_cart' | t }}
                        </button>
                    </div>
                </div>
            {% endif %}
        {% endform %}

        {% if product.description %}
            <div class="mt-4">
                {{ product.description }}
            </div>
        {% endif %}
    </div>
</div>